Да се напише/ат командата/ите за създаване на софтуерен RAID5 от 5 SATA диска

 Причините да се използва RAID могат да бъдат много,но основните са за да се комбинират няколко физически storage device-a във един по-голям виртуален такъв и за покачван на performance.Все пак е важно да се отбележи,че RIAD не е заместител за backup.В зависимост от RADI level-a вашата система ще бъде зашитена от fail на еидн или два диска,но няма да ви предпази от инцидентни команди като rm -rf /.
Към момента mdadm e стандартния tool за RAID Managment под Линукс.
Device-ите в един софтуерен RAID се наричат блокове и те могат да предсталяват както отделни физически storage device-и такa и отделни partition-и на един диск. RAID-а може да бъде изграден от device-и с различни интерфейси(IDE, SATA, SCSI) и дори могат да се нестват няколко RAID-a пoд шапката на друг RAID.

Първоначално се уверете, че кърнела ви поддържа RAID: 
modprobe raid456

След това провере какви RAID mode-oве поддържа: 
cat /proc/mdstat

Примерен аутпут от горната команда е:
Personalities : [raid6] [raid5] [raid4] 
unused devices: <none>

Това означава,че поддържаните модове са за RAID-ове от 4-то, 5-то и 6-то ниво и към момента няма build-нати RAID-ове на вашата система.

След това инсталирайте mdmda toola-a:
apt-get install mdadm

В нашия случай ще създавме RAID от 5-то нивo с 5 SATA hard drive-a, което означава, че ако fail-не един device(блок) в нашата система, то тя ще продължи да функционира безпроблемно и няма да имаме data loss.
Тове става чрез така наречения parity bits, коетo представява побитова XOR на всички 5 device-a в нашата сиситема и рекоструирането му в случаай на fail. Ako имаме втори device fail обаче, сиситематани ще падне.

Командата за създаване на RAID от 5-ти level e:

mdadm --create /dev/md0 --level=5 --raid-devices=5 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sdе1 /dev/sdf1 --spare-devices=1 /dev/sdg1

Така ще създадем RAID(md0) от level=5 с включени 5 device-a(raid-devices=5) съответно  sdb1, sdc1, sdd1, sde1. 

С последната команда --spare-devices=1 /dev/sdg1 по желание можем да добавим в края на масива още един spare device, ако разполагаме с такъв, който да добавим към масива в случай, че някой от текущите пет fail-не.

Сега погледнете какво се случва в  /proc/mdstat

Hopefully, ако вашият RAID e бил създаден успешно, ще е стартираа реконструкция, която докато не завърши вашият нов дивайс md0 все още не е консистентен.

Следващата важна стъпка е да save-аме конфигурацията на нашия RAID:
mdadm --detail --scan >> /etc/mdadm.conf 

Вече можете да създадете файлове система върху вашия нов md0 device kакто върху един обикновен partiton.

Можете да добавяте нови device-и към вашия RAID с команда:
mdadm –add /dev/md0 /dev/sdh1

За да премахнете блок от масива първо трябва да го маркирате като fail:
mdadm –fail /dev/md0 /dev/sdh1 
mdadm –remove /dev/md0 /dev/sdh1

Винаги след това задължително си правите verify:
cat /proc/mdstat || mdadm –detail /dev/md0 

Спирането на работещ RID device е лесно:
mdadm --stop /dev/md0

Не така стоят нещата със стартирането му.За да го подкарате:
mdadm --assemble /dev/md0 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sdе1 /dev/sdf1 

..или просто:
 mdadm --assemble --scan

но така рискувате да стартирате масиви които не искате(ако разбирасе имате други такива)

За допълнително инфо и advanced options:
man mdadm :)






	



